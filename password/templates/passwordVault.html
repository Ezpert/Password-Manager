<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password Vault</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


</head>
<body>

<div>
    <form action="/login/loginLanding" method="GET">
        <input type="submit" value="Back to Home <-">
    </form>


    {% if adminUser %}
        <p>Hello {{ adminUser }}! These are your currently stored passwords.</p>
    {% else %}
    <form action="/login/" method="GET">
        <p>Information not provided.</p>
        <input type="submit" value="Return to Login Page">
    </form>
    {% endif %}

</div>
{% if entries %}

       {% for entry in entries %}



{# whenever we want to get a variable we saved inside the session#}
{# ( ie. request.session['edit'] = True )#}
{#we use request.session.variable ( ie. request.session.edit ) #}
{# insead of the variable name by itself. #}


               <form action="{% url 'editPage' entry.id %}" method="POST">
                   {% csrf_token %}
                   <p>Website: {{ entry.url }}</p>
                   <p>Username: {{ entry.username }}</p>
                    <p>Password: <span id="password{{ entry.id }}" class="hide-text" ;">{{ entry.password }}</span></p>


                   <input type="submit" value="Edit >">


               </form>


                    <button id="deleteButton{{ entry.id }}" class="delete-button" >Delete</button>



       {% endfor %}

{% else %}
   <p>No entries found for this user.</p>
{% endif %}



</body>
<script>
    window.onload = function() {
  var passwordElements = document.querySelectorAll('.hide-text');
  passwordElements.forEach(function(passwordElement) {
      var passwordText = passwordElement.innerText;
      var hiddenPassword = '';
      for (var i = 0; i < passwordText.length; i++) {
          hiddenPassword += 'â€¢';
      }
      passwordElement.innerText = hiddenPassword;
  });
};

$('.delete-button').click(function() {
 var entryId = $(this).attr('id').replace('deleteButton', '');
 deleteEntry(entryId);
});

function deleteEntry(entryId) {
 $.ajax({
 url: '/delete/' + entryId,
 type: 'DELETE',
 headers: {
   "X-CSRFToken": getCookie("csrftoken")
 },
 success: function(result) {
   $('#entry' + entryId).remove();
   location.reload();
 },
 error: function(error) {
   console.log(error);
 }
 });
}
function getCookie(name) {
 var cookieValue = null;
 if (document.cookie && document.cookie !== '') {
  var cookies = document.cookie.split(';');
  for (var i = 0; i < cookies.length; i++) {
    var cookie = jQuery.trim(cookies[i]);
    // Does this cookie string begin with the name we want?
    if (cookie.substring(0, name.length + 1) === (name + '=')) {
      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
      break;
    }
  }
 }
 return cookieValue;
}

</script>



</html>
